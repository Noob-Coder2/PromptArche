{% extends "base.html" %}

{% block title %}Dashboard - PromptArche{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <header>
        <h1 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary mb-2">Your
            Evolution</h1>
        <p class="text-lg text-slate-400">Analysis of your prompting journey.</p>
    </header>

    <!-- Stats Overview -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <!-- Card 1 -->
        <div class="bg-slate-900 overflow-hidden shadow rounded-lg border border-white/5 hover:border-primary/50 transition">
            <div class="px-6 py-8 sm:p-8">
                <dt class="text-base font-medium text-slate-400 truncate">Total Prompts</dt>
                <dd class="mt-2 text-4xl font-bold text-white">{{ stats.total_prompts }}</dd>
            </div>
        </div>
        <!-- Card 2 -->
        <div class="bg-slate-900 overflow-hidden shadow rounded-lg border border-white/5 hover:border-primary/50 transition">
            <div class="px-6 py-8 sm:p-8">
                <dt class="text-base font-medium text-slate-400 truncate">Clusters Identified</dt>
                <dd class="mt-2 text-4xl font-bold text-white">{{ stats.total_clusters }}</dd>
            </div>
        </div>
        <!-- Card 3 -->
        <div class="bg-slate-900 overflow-hidden shadow rounded-lg border border-white/5 hover:border-primary/50 transition">
            <div class="px-6 py-8 sm:p-8">
                <dt class="text-base font-medium text-slate-400 truncate">Insights Generated</dt>
                <dd class="mt-2 text-4xl font-bold text-white">{{ stats.total_insights }}</dd>
            </div>
        </div>
    </div>

    <!-- Chart: Timeline -->
    <div class="bg-slate-900 shadow rounded-lg border border-white/5 p-8">
        <h3 class="text-2xl leading-8 font-bold text-white mb-6">Prompt Volume Over Time</h3>
        <div class="relative h-80 w-full">
            <canvas id="timelineChart"></canvas>
        </div>
    </div>

    <!-- Cluster Grid -->
    <div>
        <h3 class="text-2xl leading-8 font-bold text-white mb-6">Dominant Clusters</h3>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {% for cluster in clusters %}
            <div
                class="bg-slate-900 border border-white/5 rounded-lg shadow-sm hover:border-primary/50 transition duration-300 hover:shadow-lg">
                <div class="p-6 space-y-4">
                    <div class="flex justify-between items-start">
                        <h4 class="text-xl font-bold text-white leading-tight">{{ cluster.label }}</h4>
                    </div>
                    <p class="text-base text-slate-400 line-clamp-3">
                        {{ cluster.description }}
                    </p>
                    <div class="pt-4 border-t border-white/5">
                        <a href="/cluster/{{ cluster.id }}"
                            class="text-primary hover:text-indigo-300 font-medium transition text-base">View Analysis &rarr;</a>
                    </div>
                </div>
            </div>
            {% endfor %}

            {% if not clusters %}
            <div class="col-span-full text-center py-16 text-slate-500">
                <p class="text-lg">No clusters found yet. Upload data to get started.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('timelineChart').getContext('2d');
        const data = {{ chart_data | tojson
    }}; // Expecting labels and values

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Prompts',
                data: data.values,
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.05)' }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
    });
</script>
{% endblock %}