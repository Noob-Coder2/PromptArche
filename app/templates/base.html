<!DOCTYPE html>
<html lang="en" class="h-full bg-slate-950">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PromptArche{% endblock %}</title>

    <!-- CDN Stats: Lightweight versions where possible -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#ec4899',
                        dark: '#0f172a',
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body class="h-full text-slate-200 antialiased font-sans">

    <!-- Navigation -->
    <nav class="border-b border-white/10 bg-slate-900/50 backdrop-blur-md fixed w-full top-0 z-50" x-data="{ isAuthenticated: !!document.cookie.split('; ').find(row => row.startsWith('access_token=')) }">
        <!-- DB Warning Banner -->
        {% if request.app.state.db_ready is defined and not request.app.state.db_ready %}
        <div
            class="bg-red-600/90 text-white text-center py-2 px-4 text-sm font-semibold backdrop-blur-sm border-b border-red-500">
            âš  CRITICAL: Database schema not configured. Run SQL setup scripts and restart.
            <span class="opacity-80 font-normal ml-2">Missing tables: {{ request.app.state.db_missing_tables|join(', ')
                }}</span>
        </div>
        {% endif %}

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="/"
                        class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                        PromptArche
                    </a>
                </div>
                <!-- Navigation Links (Only show when authenticated) -->
                <div class="hidden md:block" x-show="isAuthenticated">
                    <div class="ml-10 flex items-baseline space-x-6">
                        <a href="/dashboard"
                            class="text-base hover:bg-white/10 px-4 py-2 rounded-md font-medium transition">Dashboard</a>
                        <a href="/upload"
                            class="text-base hover:bg-white/10 px-4 py-2 rounded-md font-medium transition">Upload</a>
                    </div>
                </div>
                <div>
                    <!-- Logout button only visible when authenticated -->
                    <button x-show="isAuthenticated" onclick="document.cookie='access_token=; Max-Age=0; path=/;'; window.location.href='/login'"
                        class="text-base text-slate-300 hover:text-white transition font-medium">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 min-h-screen pb-8">
        <div class="max-w-7xl mx-auto py-8 sm:px-6 lg:px-8">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-white/10 bg-slate-950 py-8 mt-16">
        <div class="text-center text-slate-400 text-base">
            &copy; 2024 PromptArche. Brutally Honest Insights.
        </div>
    </footer>

</body>

</html>